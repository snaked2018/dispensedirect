/**
 *  @class
 *  @function QuickShop
 */
if (!customElements.get('quick-shop')) {
  class QuickShop extends HTMLElement {
    constructor() {
      super();
    }

    connectedCallback() {
      this.button = this.querySelector('.quick-shop');
      this.drawer = this.querySelector('#Quick-Drawer');
      this.cc = document.querySelector('.click-capture');
      this.close = this.querySelector('.thb-close');
      this.container = document.getElementById('wrapper');

      this.prepareAnimations();
      this.setupEventListeners();
    }

    prepareAnimations() {
      this.tlQuickNav = gsap.timeline({
        paused: true,
        onStart: () => {
          this.container.classList.add('open-cc');
          gsap.set(this.drawer, {
            visibility: 'visible'
          });
        },
        onReverseComplete: () => {
          this.container.classList.remove('open-cc');
          gsap.set(this.drawer, {
            clearProps: 'transform'
          });
          this.drawer.blur();
        },
        onComplete: () => {
          this.drawer.focus();
        }
      });
      this.tlQuickNav
        .to(this.drawer, {
          x: '0%',
          duration: 0.25
        }, 'start')
        .from(Array.from(this.drawer.querySelectorAll('.product')).slice(0, 8), {
          duration: 0.25,
          x: '30',
          opacity: 0,
          stagger: 0.05
        }, 'start+=0.2');
    }
    setupEventListeners() {
      this.button.addEventListener('click', this.openDrawer.bind(this));
      this.cc.addEventListener('click', this.closeDrawer.bind(this));
      this.close.addEventListener('click', this.closeDrawer.bind(this));

      document.addEventListener('keyup', (e) => {
        if (e.code) {
          if (e.code.toUpperCase() === 'ESCAPE') {
            this.closeDrawer();
          }
        }
      });
    }

    openDrawer() {
      this.tlQuickNav.play();
    }
    closeDrawer() {
      this.tlQuickNav.timeScale(1.5).reverse();
    }

  }
  customElements.define('quick-shop', QuickShop);
}
